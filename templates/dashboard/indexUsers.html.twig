{% extends 'base.html.twig' %}

{% block title %}Users list - MOSAIC{% endblock %}
{% block meta %}Manage users with the admin panel on MOSAIC, through a comprehensive list of users, search by name or filter by role, alphabetical order, or registration date. Access detailed user profiles easily.{% endblock %}

{% block body %}

{# ajouter reset pour la recherche
ajouter hover
ajouter pagination #}

<div class="banner">
    <div class="content">
        <h1 class="banner-title">Users list</h1>
        <div class="subtitle">
            <p class="banner-text">Subtitle</p>
            <div class="underscore-blink"> </div>
        </div>
    </div>
</div>

 {# {{dump(users)}} #}

<div class="breadcrumb breadcrumb-dark">
    <p><a href="{{ path('app_dashboard') }}">Dashboard </a> > All Users</p>
</div>

<section class="content dashboard" id="dashboard-users-list">

    <div id="search">
        <h3 class="text-n2">Search<span>_</span></h3>
        <div id="by-username">
            {{ form_start(formUserSearch, {'method': 'POST'}) }}
            {{ form_errors(formUserSearch)}}
         
            {{ form_row(formUserSearch.username, {
             'attr': {'minlength': 3}
             }) }}
         
            <button class="btn6" type="submit">Search</button>
            {{ form_end(formUserSearch) }}
        </div>

        <div id="by-role">
            <form method="GET" action="{{ path('list_users') }}">
                <label for="role">By role : </label>
                <select id="role" name="role">
                        <option value="" disabled selected>Choose a role</option>
                        <option value="ROLE_ADMIN">admin</option>
                        <option value="ROLE_ARTIST">artist</option>
                        <option value="ROLE_SUPERVISOR">supervisor</option>
                        {# <option value=user>USER</option> #}
                </select>    
                <button class="btn6" type="submit">Filter</button>
                </form>
        </div>

        <div id="sort-by">
            <form method="GET" action="{{ path('list_users') }}">
                <label for="sortBy">Sort by : </label>
                <select id="sortBy" name="sortBy">
                    <option value="" disabled selected>Choose a filter</option>
                    <option value="username_asc">Username (A-Z)</option>
                    <option value="username_desc">Username (Z-A)</option>
                    <option value="createdAt_asc">Date of Registration (Oldest first)</option>
                    <option value="createdAt_desc">Date of Registration (Newest first)</option>
                </select>
                <button class="btn6" type="submit">Filter</button>
                </form>
        </div>
    </div>

        {% if searchResults %}
            <h2 class="text-n2">Search results</h2>
        {% else %}
            <h2 class="text-n2">All users</h2>
        {% endif %}

    <div id="list-all-users">
        <ul>
            {% for user in users %}
            <li>
                 <p>  Username : <a href="{{ path('detail_user_admin', {slug : user.slug}) }}">{{user}}</a></p>
                 <p>Email: {{user.Email}}</p>
                 <p>Registration date: {{user.registrationDate|formatDate}}</p>
        
                 <div class="roles-user">
                     {% if 'admin' in user.getSimpleRoles %}
                         <p class="artist-icon"><i class="fa-solid fa-gear"></i> Admin</p>
                     {% endif %}

                     {% if 'supervisor' in user.getSimpleRoles %}
                         <p class="artist-icon"><i class="fa-solid fa-user-tie"></i> Supervisor</p>
                     {% endif %}

                     {% if 'artist' in user.getSimpleRoles %}
                         <p class="artist-icon"><i class="fas fa-paint-brush"></i> Artist</p>
                         {% if user.isPublished == 1 %}
                            <p><a href="{{ path('show_artist' , {slug : user.slug}) }}">Artist page</a> <i class="fa-solid fa-eye"></i></p>

                            <div id="admin-moderation">
                                    
                                {% if app.user.id == user.id %}
                                {# an admin can't moderate their own artist page #}
                                {% else %}
                                    {{ form_start(formPublishPageArtist) }}
                                        {% if user.isPublished == 1 %}
                                            <button class="btn btn-red btn-artist-profil" type="submit">Moderate</button>
                                        {% elseif user.isPublished == -1 %}
                                            <button class="btn btn-blue btn-artist-profil" type="submit">Publish</button>
                                        {% endif %}
                                    {{ form_end(formPublishPageArtist) }}
                                {% endif %}
                            
                            </div>


                         {% elseif user.isPublished == -1 %}
                            <p>Artist page   <i class="fa-solid fa-eye-slash"></i> <p>
                                <div id="admin-moderation">
                                    
                                        {% if app.user.id == user.id %}
                                        {# an admin can't moderate their own artist page #}
                                        {% else %}
                                            {{ form_start(formPublishPageArtist) }}
                                                {% if user.isPublished == 1 %}
                                                    <button class="btn btn-red btn-artist-profil" type="submit">Moderate</button>
                                                {% elseif user.isPublished == -1 %}
                                                    <button class="btn btn-blue btn-artist-profil" type="submit">Publish</button>
                                                {% endif %}
                                            {{ form_end(formPublishPageArtist) }}
                                        {% endif %}
                                    
                                </div>
                            </p>
                         {% endif %}
                     {% endif %}
            
            
                 </div>
        
                 <div class="separator"></div>
                
            </li>
            {% endfor %}
        
        </ul>

    </div>

</section>



   <div id="search-results"></div>

{% endblock %}
