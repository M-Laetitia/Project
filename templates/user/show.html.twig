{% extends 'base.html.twig' %}

{% block title %}Profile{% endblock %}

{% block body %}

    <div class="banner">
        <div>
            <h1 class="banner-title">YOUR PROFIL</h1>
            <p class="banner-text">Text text<span class="underscore-static">_</span></p>
        </div>
    </div>
    
    <section class="content" id="profil-user">

        <div id="content-profil-user">
            <div id="separator-profil"></div>
            <div id="top">
                <h2 class="text-n1">{{ user }}<span>_</span> </h2>
                <div id="avatar">
                    <div>
                        <picture>
                            {% if user.avatar %}
                            <img src="{{ asset('images/avatars/' ~ user.avatar) }}">
                            {% else %}
                                <img src="{{ asset('images/default_profile.jpg') }}">
                            {% endif %}
                        </picture>
                        
                    </div>
                    <div>
                        <i class="fa-regular fa-pen-to-square fa-lg"></i>
                    </div>

                </div>
                <div id="roles">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            <div id="middle">
                <div id="left">
                    <p class="text-n2" id="infos">Info<span>_</span></p>
                    <div class="text-n3" id="info">
                        <p><span>Username :</span> {{user}}</p>
                        <p><span>Email :</span> {{ user.email }}</p>
                        <p><span>Registration date :</span> {{ user.registrationDate|date("d.m.Y") }}</p>
                        <p><span>Member since :</span> {{ user.durationSinceRegistration}}</p>
                    </div>

                    <div id="actions" class="logo-profile">
                        <div>
                            <i id="edit-infos-btn" class="fa-regular fa-pen-to-square"></i>
                            <p>Edit informations</p>
                        </div>
                        <div>
                            <i class="fa-solid fa-unlock-keyhole"></i>
                            <p>Change password</p>
                        </div>
                        <div>
                            <i id="delete-account-btn" class="fa-solid fa-x"></i>
                            <p>Delete account</p>
                        </div>
                        <div>
                            <a href=" {{ path('app_logout') }}"><i id="logout-btn" class="fa-solid fa-right-from-bracket"></i></a>
                            <p>Logout</p>
                        </div>
                    </div>

                </div>

                <div id="right">
                    <p class="text-n2" id="activities"><span>_</span>Activity</p>
                    <div class="text-n3" id="activity">
                        <div class="activity-list">
                            <i class="fa-regular fa-eye"></i>
                            <p id="event-btn">Events</p>
                        </div>

                        <div class="activity-list">
                            <i class="fa-regular fa-eye"></i>
                            <p id="expo-btn">Expositions</p>
                        </div>

                        <div class="activity-list">
                            <i class="fa-regular fa-eye"></i>
                            <p id="workshop-btn">Workshops</p>
                        </div>

                        <div class="activity-list">
                            <i class="fa-regular fa-eye"></i>
                            <p id="studio-btn">Studios</p>
                        </div>
                    </div>

                    <div class="logo-profile">
                        
                        {% if  user.subscriptions is empty %}
                            <p>No subscriptions</p>
                            <a href="{{ path('app_subscription')}}"><div><i id="subscription-inactive"class="fa-regular fa-star"></i></div></a>
                            
                            {% else %}
                                {% for subscription in user.subscriptions %}
                                    {% set daysRemaining = subscription.daysRemaining %}
                                    {% if daysRemaining.remaining > 0 and (subscription.isActive == 1) %}
                                    <p>{{ subscription.subscriptionType.name }}</p>
                                    {# <p>Payment date: {{ subscription.paymentDate|formatDate }}</p>
                                    <p>Duration: {{ subscription.subscriptionType.duration }} days</p>
                                    <p>End date: {{ daysRemaining.endDate }}</p> #}
                                    <p>Remaining days: {{ daysRemaining.remaining }}</p>
                                    <div><i id="subscription-active" class="fa-regular fa-star"></i></div>
                                    {% endif %}
                                {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <div id="bottom">
                <div id="content">
                    <div id="edit-form">
                        {{ form_start(formEditUser) }}
                        <div class="field">{{ form_row(formEditUser.username) }}</div>
                        <div class="field"> {{ form_row(formEditUser.email) }}</div>
                        <div class="field">{{ form_row(formEditUser.Validate) }}</div>
                        {{ form_end(formEditUser) }}
                    </div>

                    <div id="delete-account">
                        <p>Are you sure you want to delete your account? This action can't be undone.</p>
                        <div>
                            <div class="confirm">
                                <a href=" {{ path('delete_user', {'id': app.user.id }) }}"><i class=" icon-confirm fa-regular fa-circle-check"></i>
                                <p>Confirm</p></a>

                            </div>
                            <div class="cancel">
                                <a href="#"><i class=" icon-cancel fa-regular fa-circle-xmark"></i>
                                    <p>Cancel</p></a>
                                
                            </div>
                        </div>
                    </div>

                    {% set has_event_participation = false %}

                    {% for participation in user.areaParticipations %}
                        {% if participation.area.type == "EVENT" %}
                            {% set has_event_participation = true %}
                            {% if participation.area.status in ["OPEN", "CLOSED", "PENDING"]  %}
                                <p>Ongoing event</p>
                                {{ participation.area.name }}
                            {% elseif participation.area.status == "ARCHIVED"  %}
                                <p>Archived event</p>
                                {{ participation.area.name }}
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if not has_event_participation %}
                        <p>No events</p>
                    {% endif %}

                    {# ----------------- #}

                    {% set has_expo_participation = false %}

                    {% for participation in user.areaParticipations %}
                        {% if participation.area.type == "EXPO" %}
                            {% set has_expo_participation = true %}
                            {% if participation.area.status in ["OPEN", "CLOSED", "PENDING"]  %}
                                <p>Ongoing expo</p>
                                {{ participation.area.name }}
                            {% elseif participation.area.status == "ARCHIVED"  %}
                                <p>Archived expo</p>
                                {{ participation.area.name }}
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if not has_expo_participation %}
                        <p>No expo</p>
                    {% endif %}


                    {# ------------------- #}

                    {% set has_workshop_participation = false %}

                    {% for participation in user.workshopRegistrations %}
                        {% if participation.workshop is not null %}
                            {% set has_workshop_participation = true %}
                            {% if participation.workshop.status in ["OPEN", "CLOSED", "PENDING"]  %}
                                <p>Ongoing workshop</p>
                                {{ participation.workshop.name }}
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if not has_workshop_participation %}
                        <p>No workshop</p>
                    {% endif %}


                    {% for participation in user.workshopRegistrations %}
                        {% if participation.workshop is not null %}
                            {% if participation.workshop.status == "ARCHIVED"  %}
                                <p>Archived workshop</p>
                                {{ participation.workshop.name }}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    

                    {# ------------------- #}

                    {% set has_timeslot_participation = false %}

                    {% for participation in user.workshopRegistrations %}
                        {% if participation.timeslot is not null %}
                            {% set has_timeslot_participation = true %}

                            {% if participation.timeslot.date > date() %}
                                <p>future timeslot</p>
                                {{ participation.timeslot.studio.name }}

                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if not has_timeslot_participation %}
                        <p>No timeslot</p>
                    {% endif %}

                    {# ------------------- #}



                    {% for participation in user.workshopRegistrations %}
                        {% if participation.timeslot is not null %}
                            
                            {% if participation.timeslot.date < date() %}
                                <p>past timeslot</p>
                                {{ participation.timeslot.studio.name }}
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    <div id="activity-recap">
                        <div id="events">
                            <h3></h3>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <p>Role: {{ user.getSimpleRoles|join(', ')}} </p>

    
    <div id="avatar">
        <div id="avatar-profil">
            
        </div>
        
        <div id="form">
            {{ form_start(form) }}
            {{ form_row(form.avatar) }} 
            {{ form_end(form) }}
        </div>
    </div>


    <div>
        
        <a href=" {{ path('editPassword_user',{'id': app.user.id }) }}">change password</a>

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('#edit-form input');
           
            inputs.forEach(function(input) {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#207E93'; 
                    this.previousElementSibling.style.color = '#207E93'; 
                });
                //blur event is triggered when the input field loses focus
                input.addEventListener('blur', function() {
                    this.style.borderColor = '#939393'; 
                    this.previousElementSibling.style.color = ''; 
                });
            });
        });

        $(document).ready(function() {
            // show / hide edit account div
            $('#edit-infos-btn').click(function(){
                $("#edit-form").slideToggle();
            });
            // show / hide delete account div
            $('#delete-account-btn').click(function(){
                $("#delete-account").slideToggle();
            });
            // hide delete account on cancel
            $('.cancel').click(function() {
                event.preventDefault(); 
                $('#delete-account').slideToggle();
            });
            // change logo on hovering (confirm)
            $('.confirm').hover(
                function() {
                    $('.icon-confirm').removeClass('fa-regular').addClass('fa-solid');
                },
                function() {
                    $(this).find('.icon-confirm').removeClass('fa-solid').addClass('fa-regular');
                }
            );
            // change logo on hovering (cancel)
            $('.cancel').hover(
                function() {
                    $('.icon-cancel').removeClass('fa-regular').addClass('fa-solid');
                },
                function() {

                    $(this).find('.icon-cancel').removeClass('fa-solid').addClass('fa-regular');
                }
            );

            // show / hide eye icon on activities hover
            $('.activity-list p').hover(function() {
                $(this).prev('i').css('opacity', '1');
            }, function() {
                $(this).prev('i').css('opacity', '0');
            });
            
        })
 
    </script>

{% endblock %}
